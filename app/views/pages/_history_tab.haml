#page-changes.tab-pane
  / assume, that page itself is last page version
  - last_shown_version_id = nil

  %a.btn-primary.btn.show_changes_button Compare revisions

  %label.one-page-change
    %input{:type => "radio", "data-page-change" => ''}
    Actual version of page
    %b= @page.full_title_101


  - all_page_changes = @page.page_changes
  - all_page_changes = all_page_changes.zip(PageChange.where(:related_changed_pages => @page.id).to_a).flatten.compact

  - all_page_changes.sort! { |a,b| b.created_at <=> a.created_at }

  - all_page_changes.each do |page_change|
    %label.one-page-change
      - if page_change.page == @page
        %input{:type => "radio", "data-page-change" => page_change.id}
        - last_shown_version_id = page_change.id
        - if page_change.user
          %img.small_avatar{:src => page_change.user.github_avatar}
          %a{:href=> "mailto:#{page_change.user.email}"}= page_change.user.name
        - else
          UFO
        edited this article
        = time_ago_in_words page_change.created_at
        ago.

        %a{:href => "/page_changes/diff/#{page_change.id}/#{last_shown_version_id}", :target => '_blank'} Show diff with previous revision
        |
        - if can? :manage, page_change.page
          %a{:href => "/page_changes/apply/#{page_change.id}"} Apply revision
          |
        %a{:href => "/page_changes/show/#{page_change.id}", :target => '_blank'} Show revision
      - else
        %input{:type => "radio", :disabled => true, "data-page-change" => page_change.id}
          %i
            During this action page was changed
          = page_change.git_commit_message
  %a.btn-primary.btn.show_changes_button Compare revisions
