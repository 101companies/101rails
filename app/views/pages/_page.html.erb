<div style="display: none;" id='rename-path' data-value="<%= rename_page_path(@page) %>"></div>

<div id="renameModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class='modal-dialog'>
    <div class='modal-content'>
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
        <h3>Rename Page</h3>
      </div>
      <div class="modal-body">
        <div class="modal-body">
          <p>New title:</p>
          <input id="newTitle" name="newTitle" value="<%= @page.full_title %>" type="text">
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
        <button class="btn btn-primary" id='renamePageButton'>Save changes</button>
      </div>
    </div>
  </div>
</div>

<% if !@page.nil? && @page.verified == false %>
<div class=alert alert-warning>
  <strong>The page hasn't been verified by an Adminstrator yet!</strong>
</div>
<% end %>


<div id='contentTop'>
  <% if !@script_render %>
  <div id='topEditBar' class='editBar'>
    <div class="btn-toolbar notEditing" style="display: block;">

      <div class="btn-group">
        <%= render "/pages/repo_tab" %>
        <% if request && can?(:edit, @page) %>
        <a href='<%= edit_page_path(@page.full_title) %>' class="editbutton  btn btn-sm btn-default" id="pageEditButton">
          <i class="glyphicon glyphicon-pencil"></i>
          <strong class="editbuttontext"> Edit</strong>
        </a>
        <% if current_user.role == ('admin' || 'editor') %>
          <% if !@page.nil? && @page.verified == false %>
          	<a href='<%= verify_page_path(@page.full_title) %>' data-method="put" class="editbutton  btn btn-sm btn-default" id="pageVerifyButton">
              <i class=""></i>
              <strong class="editbuttontext"> Verify</strong>
            </a>
        	<% end %>
          <button class="editbutton  btn btn-sm btn-default" id="pageDeleteButton">
            <i class="glyphicon glyphicon-trash"></i><strong> Delete</strong>
          </button>
        <% end %>
          <a href='#renameModal' data-toggle="modal" class="editbutton  btn btn-sm btn-default" id="pageRenameButton">
            <i class="glyphicon glyphicon-share-alt"></i>
            <strong class="editbuttontext"> Rename</strong>
          </a>
          <%= link_to(unverify_page_path(@page.full_title), class: 'editbutton  btn btn-sm btn-default') do %>
            <i class="glyphicon glyphicon-remove-circle"></i>
            <strong class="editbuttontext"> Unverify</strong>
          <% end %>
          <a data-toggle='modal' href='#myModal' class="editbutton  btn btn-sm btn-default" id="pageEditButton">
            <i class="glyphicon glyphicon-pencil"></i>
            <strong class="editbuttontext"> Save As</strong>
          </a>
        <% else %>
          <a href='<%= edit_page_path(@page.full_title) %>' class="editbutton  btn btn-sm btn-default" id="showSourceButton">
            <i class="glyphicon glyphicon-share-alt"></i>
            <strong class="editbuttontext"> Show Markup</strong>
          </a>
        <% end %>
      </div>
     </div>
  </div>
  <% end %>

  <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title" id="myModalLabel">Save Page As HTML</h4>
        </div>
        <div class="modal-body">
          Do you really want to save the current page and all referenced pages?<br>
          The result will be stored here:<br>
          <a href='http://data.101companies.org/pages' target="_blank">http://data.101companies.org/pages</a>
        </div>
        <div class="modal-footer">
          <a type="button" class="btn btn-default" href='#' id='render-page-button' data-page-id="<%= raw @page.id %>">Ok</a>
          <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
        </div>
      </div>
    </div>
  </div>
  <div id="<%= @page.id %>">
    <h1><%= @page.full_title %></h1>
  </div>

</div>

<div id='sections'>
  <%= @page.render.html_safe %>

  <% if @rdf.count > 0 %>
  <div class='section' id='metasection'>
    <div class='headlinecontainer'>
      <h2 class='headline'>Metadata</h2>
    </div>

    <%= render 'pages/triples', triples: @rdf, hover_show: false %>

  </div>
  <% end %>

</div>

<% if !@script_render && @page.backlinks.count > 0 %>
<div class='additional-sections'>
  <div class="section" id="backlinks" style="display: block;">
     <h2>Backlinks</h2>

     <div class='backlinks-body'>
       <% @page.backlinks.each do |link| %>
         <a href="<%= '/wiki/' + link.sub(' ', '_') %>">
           <span class="backlink">
             <%= link %>
           </span>
         </a>
       <% end %>
     </div>

  </div>
</div>
<% end %>

<% if @resources && @resources.count > 0 %>
<div class='addtional-sections' id='last-section'>

  <div class='section' id='resources' style='display: block;'>
    <h2 class='headline'>Resources</h2>

    <%= render 'resources', resources: @resources, books: @books %>
  </div>
</div>
<% end %>

<hr>

<% if !@script_render %>
  <div id="infofooter">
    <div class='history'>
      <% @change = @page.get_last_change %>
      <% if @change[:created_at] %>
      <img class="small_avatar" height="24" src="<%= @change[:user_pic] %>" width="24">
      <a href="mailto:<%= @change[:user_email] %>"><%= @change[:user_name] %></a>

      edited this article at
      <%= l @change[:created_at] %>
      <% end %>

    </div>
  </div>
<% end %>

<div class='copyright-notice'>
  (C) 2012--<%= Time.now.year %> <a href='http://101companies.org'>101companies.org</a> and <a href='http://softlang.org'>softlang.org</a>
</div>
