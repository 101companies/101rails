<script type="text/javascript">

    Wiki.pageTitle = <%= j @page.full_title.to_json.html_safe -%>;

    Wiki.pageContent= "<%= escape_javascript(@page.raw_content.html_safe) -%>";
    Wiki.pageNiceTitle=  "<%= j @page.url.html_safe -%>";
    Wiki.pageSections= <%= j @page.sections.to_json.html_safe -%>;
    Wiki.pageBacklinks= <%= j @page.backlinks.to_json.html_safe -%>;
    Wiki.pageHistory= <%= j @page.get_last_change.to_json.html_safe -%>;
    Wiki.pageTriples= <%= j get_rdf_json(@page.full_title, true).to_json.html_safe -%>;

    <% if current_user -%>

        Wiki.currentUser = new Wiki.Models.User(<%= j current_user.to_json.html_safe %>);

        <% if can? :update, @page %>
            Wiki.currentUser.set('actions', ['View', 'Edit'])
        <% else %>
            Wiki.currentUser.set('actions', ['View'])
        <% end %>

    <% else -%>

        Wiki.currentUser = new Wiki.Models.User();
        Wiki.currentUser.set('actions', ['View'])

    <% end -%>

    jQuery(document).ready(function ($){
        window.router = new Wiki.Routers.PagesRouter();
        Backbone.history.start();
    })

</script>
